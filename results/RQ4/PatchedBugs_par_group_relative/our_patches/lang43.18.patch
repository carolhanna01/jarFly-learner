--- ./original/org/apache/commons/lang/text/ExtendedMessageFormat.java	2022-12-16 08:56:34.000000000 +0000
+++ ./variant658/org/apache/commons/lang/text/ExtendedMessageFormat.java	2022-12-16 14:40:07.000000000 +0000
@@ -155,11 +155,17 @@
         while (pos.getIndex() < pattern.length()) {
             switch (c[pos.getIndex()]) {
             case QUOTE:
-                appendQuotedString(pattern, pos, stripCustom, true);
+                {
+					appendQuotedString(pattern, pos, stripCustom, true);
+					next(pos);
+				}
                 break;
             case START_FE:
                 fmtCount++;
-                seekNonWs(pattern, pos);
+                {
+					seekNonWs(pattern, pos);
+					seekNonWs(pattern, pos);
+				}
                 int start = pos.getIndex();
                 int index = readArgumentIndex(pattern, next(pos));
                 stripCustom.append(START_FE).append(index);
@@ -254,7 +260,11 @@
             }
             FormatFactory factory = (FormatFactory) registry.get(name);
             if (factory != null) {
-                return factory.getFormat(name, args, getLocale());
+                if (!(factory != null)) {
+					return null;
+				} else {
+					return factory.getFormat(name, args, getLocale());
+				}
             }
         }
         return null;
@@ -363,7 +373,9 @@
                             readArgumentIndex(pattern, next(pos)));
                     String customPattern = (String) customPatterns.get(fe);
                     if (customPattern != null) {
-                        sb.append(START_FMT).append(customPattern);
+                        if (sb != null) {
+							sb.append(START_FMT).append(customPattern);
+						}
                     }
                 }
                 break;
