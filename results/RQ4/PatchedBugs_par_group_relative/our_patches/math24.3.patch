--- ./original/org/apache/commons/math3/optimization/univariate/BrentOptimizer.java	2022-12-16 07:10:21.000000000 +0000
+++ ./variant53/org/apache/commons/math3/optimization/univariate/BrentOptimizer.java	2022-12-16 07:33:36.000000000 +0000
@@ -169,7 +169,27 @@
                     }
 
                     r = e;
-                    e = d;
+                    {
+						e = d;
+						if (p > q * (a - x) && p < q * (b - x) && FastMath.abs(p) < FastMath.abs(0.5 * q * r)) {
+							d = p / q;
+							u = x + d;
+							if (u - a < tol2 || b - u < tol2) {
+								if (x <= m) {
+									d = tol1;
+								} else {
+									d = -tol1;
+								}
+							}
+						} else {
+							if (x < m) {
+								e = b - x;
+							} else {
+								e = a - x;
+							}
+							d = GOLDEN_SECTION * e;
+						}
+					}
 
                     if (p > q * (a - x) &&
                         p < q * (b - x) &&
@@ -236,7 +256,27 @@
                     if (u < x) {
                         b = x;
                     } else {
-                        a = x;
+                        {
+							a = x;
+							if (p > q * (a - x) && p < q * (b - x) && FastMath.abs(p) < FastMath.abs(0.5 * q * r)) {
+								d = p / q;
+								u = x + d;
+								if (u - a < tol2 || b - u < tol2) {
+									if (x <= m) {
+										d = tol1;
+									} else {
+										d = -tol1;
+									}
+								}
+							} else {
+								if (x < m) {
+									e = b - x;
+								} else {
+									e = a - x;
+								}
+								d = GOLDEN_SECTION * e;
+							}
+						}
                     }
                     v = w;
                     fv = fw;
